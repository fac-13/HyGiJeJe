## API Project Notes 

  

#### User stories

* I would like to be able to search for a movie and be presented with movies that match what I searched for
*  I would like to my movie search results to tell me what the movies are about
*  I would like to be able to see some cast information for the movie
*   I would like to be able to see an image of the cast members that I am presented with as well as some information about them
*  I would like to be able find out more about the cast by viewing the wikipedia entry for the cast member I want to find out more about
*  As a visually impaired person I would like to be able to navigate the website enjoying the same functionality as sighted users
*   I would like to be able to access the website on devices of different sizes and have a consistent experience

  

#### Function calling order

1. **When the submit button is clicked a request is made to ‘The Movie Database’**

```
apiRequests.makeRequest(url, apiRequests.movieDetails, displayMovies);
```
**_makeRequest_** is the generic XML function call, it takes two callbacks:

**_dataSelect_** - extracts the relevant information from whichever API has been called. The entire response from the API request is passed into this callback

**_outputInDom_**  - takes in the return value of dataSelect (i.e. the information we choose to extract from the API response). In this case, the data is passed straight into the displayMovies function in dom.js


**2 . The displayMovies function**

The displayMovies function primarily adds the relevant content from the API response to the page. As 4 movies are displayed, a forEach loop is used and each movie is placed in its on ‘wrapper’ (```<article>```) and added to the page.

Preparation for the next API call is also completed. The movieIds for all of the movies are stored in a global array. This is necessary to make the next call to ‘The Movie Database’

The key line in this function is:

```
apiRequests.buildActorUrl(movieIds);
```
  

This makes a call to the buildActorUrl function (in logic.js) passing in the array of movies.

**3. The buildActorUrl function**

The buildActorUrl function is located in logic.js. It maps over the array of movieIds and for each id, builds the url needed to call ‘The movie Database’ API’s cast information request.  Once, the url is built, the API request is made using the generic makeRequest function passing in two callbacks:
```
apiRequests.makeRequest(url2, apiRequests.getMovieActors, apiRequests.buildWikiUrl);
```
**getMovieActors** - This extracts the relevant information from the cast information request made to the ‘The Movie Database’. It returns an array of the 4 actors in the movie.

**build.WikiUrl** - This takes in the response from getMovieActors (an array of 4 names). The function iterates over the array it receives and firstly replaces spaces in the individual name string (i.e. “Emma Watson”) with a ‘+’ sign (i.e. “Emma+Watson”). This name is then used to create the appropriate url needed to query the wikipedia API for results matching the name.

Lastly, the function makes the API call to wikipedia to get information for that actor:

```
apiRequests.makeRequest(url3, apiRequests.getActorInfo, displayActor);
```

**4.The API request to wikipedia**

```
apiRequests.makeRequest(url3, apiRequests.getActorInfo, displayActor);
```
  
The API request is made to Wikipedia using the generic makeRequest function again, passing in two callbacks:

 **getActorInfo** - This takes in the entire response received from the wikipedia API call. The wikipedia results are not returned in any order, however, it does appear that the object within the wikipedia response object that has an index of 1 is the most relevant. Unfortunately, the object with the index of 1 is not always the first object. Therefore, the first part of this function finds the object in the results which has an index of 1 and then stores the id of this object (generated by wikipedia when the request is made) so it can be accessed. The relevant information is then extracted from that object.

**displayActor** - This takes the response from the getActorInfo function and adds it to the correct place on the page. The key part of this code is:
```
for(var  i=0; i < list.length; i++) {
	if(list[i].childNodes.length <= 6) {
		list[i].appendChild(div);
		break;
	}
}
```
  
This loop is used to iterate over the article elements which have a class of list (each movie is stored in its own article). The actor information (contained in the div) is appended to the article which has fewer than 7 children. This ensures that the actor information is added to the correct place.